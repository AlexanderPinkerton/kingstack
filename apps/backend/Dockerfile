# apps/backend/Dockerfile

# Stage 1: Build
FROM node:20 AS build
WORKDIR /app

# ðŸ‘‡ Copy the whole monorepo context
COPY . .

# ðŸ‘‡ Install everything (monorepo-wide)
RUN corepack enable && yarn install --immutable

# ðŸ‘‡ Generate the Prisma client using the shared schema
RUN yarn prisma generate --schema=packages/prisma/schema.prisma

# ðŸ‘‡ Build the backend app
WORKDIR /app/apps/backend
RUN yarn build

# Stage 2: Runtime
FROM node:20-slim
WORKDIR /app

COPY --from=build /app/apps/backend/dist ./dist
COPY --from=build /app/node_modules ./node_modules
COPY --from=build /app/apps/backend/package.json ./

CMD ["node", "dist/main"]


## THIS DOES NOT WORK YET